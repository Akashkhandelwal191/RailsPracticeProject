<!-- Start Section Of Navbar -->
<nav class="navbar navbar-expand-lg bg-body-tertiary">
  <div class="container-fluid">
    <a class="navbar-brand ms-5" href="/">Let's Shop</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse ms-5" id="navbarSupportedContent">
      <form class="d-flex w-50" role="search">
        <input class="form-control me-2" type="search" placeholder="Search for products,brands and more" aria-label="Search">

        <button class="btn btn-outline-success" type="submit">Search</button>
      </form>

         <ul class="navbar-nav me-auto mb-2 mb-lg-0 ms-5">
          <% if user_signed_in? %>
            <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
             <%= current_user.first_name %>
            </a>
            <ul class="dropdown-menu">

            <li><a class="dropdown-item" href="/homes/show"><i class="bi bi-person-circle"></i> &nbsp; My Profile</a> </li>
            <li><a class="dropdown-item" href="#"><i class="bi bi-mailbox2"></i>
             &nbsp; Orders</a></li>
            <li><a class="dropdown-item" href="/wish_lists"><i class="bi bi-suit-heart-fill"></i>
             &nbsp; Wishlist(<%= count_wish_list_products%>)</a></li>
            <li><hr class="dropdown-divider"></li>

            <li><a data-turbo-method="delete" class="dropdown-item" href="/users/sign_out"><i class="bi bi-power"></i>&nbsp; Logout</a></li>
            </ul>
            </li>
          <%else%>
          <li>
           <%= link_to 'Login', new_user_session_path,class:"btn btn-outline-info" %></li> 
          <%end%>
        
         <li class="nav-item dropdown ms-5">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            More
          </a>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Action</a></li>
            <li><a class="dropdown-item" href="#">Another action</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="#">Something else here</a></li>
          </ul>
        </li>
        <li class="nav-item ms-5">
          <a class="nav-link fs-6" href="/carts"><i class="bi bi-cart4"></i> Cart</a>
        </li>
      </ul>
      
    </div>
  </div>
</nav>
<!-- End Section Of Navbar -->

<!-- Start Section Of Custom Toast -->
<div id="custom-toast">
   <p>Custom Toast</p>
</div>
<!-- End Section Of Custom Toast -->

<!-- Start Section Of Product Page -->
<div class="card mb-3 border border-2 mt-3" style="width: 100%;">
  <div class="row g-0">
    <div class="col-md-4">
        <div class="d-flex justify-content-end p-2">
                <a  href='javascript:void(0)' class='additemtowish' data-id="<%= @product.id%>">
                  <!-- <i class="bi bi-heart-fill" style="font-size: 20px;color:red"></i> -->
                  <i class="bi bi-suit-heart ticon" id="product<%= @product.id %>"></i>
                </a>
        </div>
        <div class="p-5" style="max-width: 350px;">
        <%= image_tag @product.product_images.first,class:"img-fluid"%>
        </div>
        <div class="d-flex justify-content-between p-3">
            <button class="btn btn-success w-100 p-2"><i class="bi bi-cart-fill"></i> &nbsp; ADD TO CART</button>
            &nbsp; &nbsp;
            <button class="btn btn-warning w-100 p-2"><i class="bi bi-lightning-charge-fill"></i> &nbsp; BUY NOW</button>   
        </div>
    </div>
    <div class="col-md-8">
      <div class="card-body">
        <h3 class="card-title"><%= @product.product_name%></h3>
        <span class="rating">
         <%if @product.reviews.present? %>
           <%= avg_rating(@product.id) %>
         <%else%>
         <strong>3.9</strong>
         <%end%> 
         <i class="bi bi-star-fill"></i></span>
        <div class="mt-3">
        <div>

          <span>
          <h6 style="color:green">Special Price</h6>  
          <span class="card-text fs-4">â‚¹<%= format_number(calculateoffer(@product.product_price,@product.offer)) %></span>
          &nbsp;
          <del><%= format_number(@product.product_price)%></del>
          &nbsp;
          <span class="fs-6" style="color:green"><%= @product.offer%>% off </span>
          </span>

        </div>
        <div class="mt-3">
         <h6 class="card-text"><%= @product.product_description %></h6>
        </div>
       </div>
      <div class="mt-3">
          <h2>Reviews(<%= @product.reviews.count %>)</h2>
        <% if @product.reviews.present? %>
          <% @product.reviews.each do |review| %>
             <div class="mt-2 border border-2 p-2" style="outline:none; box-shadow: 5px 5px 5px whitesmoke;">
             <span class="rating"><%= review.rating %> <i class="bi bi-star-fill"></i></span>
             &nbsp;
             <span style="font-family: monospace; font-weight:bold"><%= calculate_rating(review.rating) %></span>
             <h6 class="mt-2" style="font-family: italic;"><%= review.description %></h6>
            <p style="font-family: italic; font-weight: bolder;">By <%= review.user.first_name %> <%= review.user.last_name %></p>
            </div>
          <%end%>
        <%else%>
            <p style="color:darkcyan;">No Reviews Yet!!</p>
        <%end%>
      </div>
      <!--  <div class="mt-2">
          <button class="btn btn-primary" id="add-review-trigger">Add Your Review For This Product </button>
       </div> -->

       <!-- <div class="border border-2 review-form mt-2" id="review-f">  -->
        <%= link_to 'Add a Review', new_product_review_path(@product),class:"btn btn-primary mt-2" %>
       <!-- </div> -->
      </div>
    </div>
  </div>
</div>
<!-- End Section Of Product Page -->


<!-- Start Section Of Js -->
<% if user_signed_in? %>  
   <script>
      var pid = <%= @product.id %>    
      let b = document.getElementById(`product${pid}`)
      b.classList.remove("bi-suit-heart")
      b.classList.add("bi-heart-fill")
      b.style.color = "red"
    </script>   
<% end %>
<!-- End Section Of Js -->


